<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workout Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        :root {
            --bg: #0a0a0a;
            --surface: #1a1a1a;
            --surface-hover: #252525;
            --text: #ffffff;
            --text-dim: #a0a0a0;
            --accent: #7DF9FF;
            --accent-dim: #5dd7df;
            --border: #333;
            --chest: #ff4d6d;
            --back: #4d9fff;
            --triceps: #ff9f4d;
            --biceps: #9f4dff;
            --legs: #4dff9f;
            --shoulders: #ff4d9f;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            padding-bottom: 80px;
            overflow-x: hidden;
        }

        .header {
            position: sticky;
            top: 0;
            background: var(--bg);
            border-bottom: 1px solid var(--border);
            padding: 16px 20px;
            z-index: 100;
            backdrop-filter: blur(20px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, var(--accent), #00ddff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex-shrink: 0;
        }

        .header-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .tabs {
            display: flex;
            gap: 8px;
            padding: 12px 20px;
            overflow-x: auto;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 57px;
            z-index: 99;
            scrollbar-width: none;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 10px 20px;
            border-radius: 20px;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .tab.active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
            transform: scale(1.05);
        }

        .exercise-list {
            padding: 20px;
        }

        .exercise-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .exercise-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--accent);
            opacity: 0;
            transition: opacity 0.2s;
        }

        .exercise-card:active {
            transform: scale(0.98);
            background: var(--surface-hover);
        }

        .exercise-card:active::before {
            opacity: 1;
        }

        .exercise-name {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text);
        }

        .last-workout {
            font-size: 13px;
            color: var(--text-dim);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .last-workout-value {
            color: var(--accent);
            font-weight: 600;
        }

        .no-data {
            color: var(--text-dim);
            font-style: italic;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            overflow-y: auto;
            animation: fadeIn 0.2s;
        }

        .modal.show {
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--surface);
            border-radius: 20px;
            padding: 24px;
            width: 100%;
            max-width: 500px;
            margin-top: 40px;
            animation: slideUp 0.3s;
            border: 1px solid var(--border);
        }

        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }

        .close-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--bg);
            border: none;
            color: var(--text-dim);
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .close-btn:active {
            background: var(--border);
            transform: scale(0.9);
        }

        .last-reference {
            background: var(--bg);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .last-reference-title {
            font-size: 12px;
            text-transform: uppercase;
            color: var(--text-dim);
            font-weight: 600;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .last-reference-value {
            font-size: 14px;
            color: var(--accent);
            font-weight: 600;
        }

        .sets-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .set-row {
            display: grid;
            grid-template-columns: 60px 1fr 1fr;
            gap: 12px;
            align-items: center;
        }

        .set-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-dim);
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .input-label {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-dim);
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        input[type="number"] {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 12px;
            color: var(--text);
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            width: 100%;
            transition: all 0.2s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--surface);
        }

        .save-btn {
            width: 100%;
            padding: 16px;
            background: var(--accent);
            color: var(--bg);
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .save-btn:active {
            transform: scale(0.98);
            background: var(--accent-dim);
        }

        .nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            z-index: 100;
        }

        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-dim);
            font-size: 12px;
            cursor: pointer;
            padding: 8px 20px;
            transition: all 0.2s;
            font-weight: 600;
        }

        .nav-btn.active {
            color: var(--accent);
        }

        .nav-icon {
            font-size: 24px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .progress-screen {
            padding: 20px;
        }

        .muscle-selector {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            color: var(--text);
            font-size: 16px;
            margin-bottom: 16px;
            width: 100%;
            font-weight: 600;
        }

        .exercise-selector {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            color: var(--text);
            font-size: 16px;
            margin-bottom: 20px;
            width: 100%;
            font-weight: 600;
        }

        .chart-container {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 12px;
            text-align: center;
        }

        .stat-label {
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-dim);
            margin-bottom: 6px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
        }

        .pr-celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: var(--accent);
            color: var(--bg);
            padding: 30px 40px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 800;
            text-align: center;
            z-index: 2000;
            animation: celebrate 2s forwards;
            box-shadow: 0 0 60px rgba(0, 255, 136, 0.5);
        }

        @keyframes celebrate {
            0% { transform: translate(-50%, -50%) scale(0) rotate(-10deg); }
            50% { transform: translate(-50%, -50%) scale(1.1) rotate(5deg); }
            70% { transform: translate(-50%, -50%) scale(1) rotate(-2deg); }
            100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-dim);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 14px;
            line-height: 1.5;
        }

        .sync-status {
            position: fixed;
            top: 70px;
            right: 20px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 99;
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--surface);
            border: 1px solid var(--border);
        }

        .sync-status.synced {
            color: var(--accent);
        }

        .sync-status.syncing {
            color: #ffd700;
        }

        .sync-status.error {
            color: #ff4d4d;
        }

        .sync-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
        }

        .google-signin {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            z-index: 1001;
            max-width: 400px;
        }

        .google-signin h2 {
            font-size: 24px;
            margin-bottom: 16px;
            color: var(--text);
        }

        .google-signin p {
            color: var(--text-dim);
            margin-bottom: 24px;
            line-height: 1.5;
        }

        .google-signin-btn {
            background: white;
            color: #1f1f1f;
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s;
        }

        .google-signin-btn:hover {
            background: #f0f0f0;
        }

        .google-logo {
            width: 20px;
            height: 20px;
        }

        .sign-out-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            margin-left: 12px;
            transition: all 0.2s;
        }

        .sign-out-btn:active {
            background: var(--surface-hover);
        }

        .workout-history {
            margin-top: 20px;
        }

        .history-item {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .history-date {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
        }

        .history-actions {
            display: flex;
            gap: 8px;
        }

        .history-btn {
            padding: 6px 12px;
            border-radius: 8px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-dim);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-btn.edit:active {
            background: var(--accent);
            color: var(--bg);
            border-color: var(--accent);
        }

        .history-btn.delete:active {
            background: #ff4d4d;
            color: white;
            border-color: #ff4d4d;
        }

        .history-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 8px;
        }

        .history-stat {
            font-size: 13px;
            color: var(--text-dim);
        }

        .history-stat span {
            color: var(--accent);
            font-weight: 600;
        }

        .history-sets {
            font-size: 12px;
            color: var(--text-dim);
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border);
        }

        .view-history-btn {
            width: 100%;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 12px;
            transition: all 0.2s;
        }

        .view-history-btn:active {
            background: var(--surface-hover);
        }

        .history-empty {
            text-align: center;
            padding: 20px;
            color: var(--text-dim);
            font-size: 14px;
            font-style: italic;
        }

        .add-set-btn {
            width: 100%;
            padding: 10px;
            background: transparent;
            border: 1px dashed var(--border);
            border-radius: 8px;
            color: var(--accent);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 8px;
            transition: all 0.2s;
        }

        .add-set-btn:active {
            background: var(--surface-hover);
            border-color: var(--accent);
        }

        .remove-set-btn {
            background: transparent;
            border: 1px solid #ff4d4d;
            color: #ff4d4d;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            cursor: pointer;
            margin-left: 8px;
            transition: all 0.2s;
        }

        .remove-set-btn:active {
            background: #ff4d4d;
            color: white;
        }

        .manage-exercises-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            margin-left: 12px;
            transition: all 0.2s;
        }

        .manage-exercises-btn:active {
            background: var(--surface-hover);
        }

        .add-exercise-section {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
        }

        .add-exercise-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
        }

        .add-exercise-input {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            color: var(--text);
            font-size: 14px;
            margin-bottom: 8px;
        }

        .add-exercise-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .add-exercise-btn {
            width: 100%;
            padding: 10px;
            background: var(--accent);
            color: var(--bg);
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-exercise-btn:active {
            background: var(--accent-dim);
            transform: scale(0.98);
        }

        .custom-exercise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .custom-exercise-name {
            font-size: 14px;
            color: var(--text);
        }

        .delete-exercise-btn {
            background: transparent;
            border: 1px solid #ff4d4d;
            color: #ff4d4d;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-exercise-btn:active {
            background: #ff4d4d;
            color: white;
        }

        .manage-screen {
            padding: 20px;
        }

        .manage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .manage-title {
            font-size: 20px;
            font-weight: 700;
        }

        .back-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .back-btn:active {
            background: var(--surface-hover);
        }

        .muscle-group-section {
            margin-bottom: 30px;
        }

        .muscle-group-header {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid var(--border);
        }

        .analytics-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .analytics-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 16px;
        }

        .radar-container {
            max-width: 400px;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>WORKOUT TRACKER</h1>
        <div class="header-buttons">
            <button class="manage-exercises-btn" onclick="switchScreen('manage')">Manage Exercises</button>
            <button class="sign-out-btn" id="signOutBtn" style="display: none;" onclick="signOut()">Sign Out</button>
        </div>
    </div>

    <div class="sync-status" id="syncStatus" style="display: none;">
        <div class="sync-dot"></div>
        <span id="syncText">Synced</span>
    </div>

    <div id="googleSignIn" class="google-signin" style="display: none;">
        <h2>üèãÔ∏è Workout Tracker</h2>
        <p>Sign in with Google to sync your workouts across all your devices. Your data will be saved securely to your Google Drive.</p>
        <button class="google-signin-btn" onclick="handleGoogleSignIn()">
            <svg class="google-logo" viewBox="0 0 24 24">
                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
            </svg>
            Sign in with Google
        </button>
    </div>

    <!-- Log Screen -->
    <div id="logScreen" class="screen active">
        <div class="tabs" id="muscleTabs"></div>
        <div class="exercise-list" id="exerciseList"></div>
    </div>

    <!-- Progress Screen -->
    <div id="progressScreen" class="screen">
        <div class="progress-screen">
            <div class="analytics-card">
                <div class="analytics-title">Muscle Group Distribution</div>
                <div class="radar-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>
            <select class="muscle-selector" id="progressMuscleSelect"></select>
            <select class="exercise-selector" id="progressExerciseSelect"></select>
            <div class="chart-container">
                <canvas id="progressChart"></canvas>
            </div>
            <div class="stats-grid" id="statsGrid"></div>
        </div>
    </div>

    <!-- Manage Exercises Screen -->
    <div id="manageScreen" class="screen">
        <div class="manage-screen">
            <div class="manage-header">
                <div class="manage-title">Manage Exercises</div>
                <button class="back-btn" onclick="switchScreen('log')">‚Üê Back</button>
            </div>
            <div id="manageExercisesList"></div>
        </div>
    </div>

    <!-- Log Workout Modal -->
    <div id="logModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle"></div>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div class="last-reference" id="lastReference"></div>
            <div class="sets-container" id="setsContainer"></div>
            <button class="save-btn" onclick="saveWorkout()" id="saveBtn">Save Workout</button>
            <button class="view-history-btn" onclick="toggleHistory()">View History</button>
            <div class="workout-history" id="workoutHistory" style="display: none;"></div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav">
        <button class="nav-btn active" onclick="switchScreen('log')">
            <div class="nav-icon">üèãÔ∏è</div>
            <div>Log</div>
        </button>
        <button class="nav-btn" onclick="switchScreen('progress')">
            <div class="nav-icon">üìä</div>
            <div>Progress</div>
        </button>
    </div>

    <script>
        const defaultExercises = {
            'Chest': ['Bench Press', 'Smithing Machine Bench Press', 'Incline Bench Press', 
                      'Incline Smithing Machine Bench Press', 'Dumbbell Bench Press', 
                      'Incline Dumbbell Bench Press', 'Pec Deck'],
            'Back': ['Lat Pulldowns', 'Cable Lat Rows', 'Cable Lat Pull Overs', 
                     'Weighted Pullups', 'Lower Back Extensions', 'Deadlifts'],
            'Triceps': ['Cable tricep Pushdowns', 'Skull Crushers', 'Cable tricep kick backs'],
            'Biceps': ['Seated Curls', 'Hammer Curls', 'Cable Curls', 'Preacher Curls'],
            'Legs': ['Squats', 'Hip Thrusts', 'RDLs', 'Leg Extensions', 'Hamstring Curls', 
                     'Calf Raises', 'Hip Abductor (out)', 'Hip Adductor (in)'],
            'Shoulders': ['Reverse Pec Deck', 'Face Pulls', 'Dumbbell Lateral Raises', 
                          'Cable Lateral Raises', 'Overhead Press']
        };

        let exercises = JSON.parse(JSON.stringify(defaultExercises)); // Deep copy

        let currentMuscle = 'Chest';
        let currentExercise = null;
        let chart = null;
        let radarChart = null;
        let storageAvailable = false;
        let googleAccessToken = null;
        let driveFileId = null;
        const DRIVE_FILENAME = 'workout_tracker_data.json';
        let editingWorkoutIndex = null;
        let currentSetCount = 3;

        // Google OAuth2 configuration
        const CLIENT_ID = '256828609249-3encedcb37f6hc3ol1qi9v5morf8jdnp.apps.googleusercontent.com';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        // Check if user needs to sign in
        function checkGoogleAuth() {
            const token = localStorage.getItem('google_access_token');
            const expiry = localStorage.getItem('google_token_expiry');
            
            if (token && expiry && Date.now() < parseInt(expiry)) {
                googleAccessToken = token;
                driveFileId = localStorage.getItem('drive_file_id');
                document.getElementById('googleSignIn').style.display = 'none';
                document.getElementById('syncStatus').style.display = 'flex';
                document.getElementById('signOutBtn').style.display = 'inline-block';
                return true;
            }
            
            // Show sign-in screen
            document.getElementById('googleSignIn').style.display = 'block';
            return false;
        }

        // Handle Google Sign-In
        function handleGoogleSignIn() {
            const redirectUri = window.location.origin + window.location.pathname;
            const authUrl = `https://accounts.google.com/o/oauth2/v2/auth?` +
                `client_id=${CLIENT_ID}` +
                `&redirect_uri=${encodeURIComponent(redirectUri)}` +
                `&response_type=token` +
                `&scope=${encodeURIComponent(SCOPES)}`;
            
            window.location.href = authUrl;
        }

        // Handle OAuth redirect
        function handleOAuthRedirect() {
            const hash = window.location.hash.substring(1);
            const params = new URLSearchParams(hash);
            const token = params.get('access_token');
            const expiresIn = params.get('expires_in');
            
            if (token) {
                googleAccessToken = token;
                const expiry = Date.now() + (parseInt(expiresIn) * 1000);
                localStorage.setItem('google_access_token', token);
                localStorage.setItem('google_token_expiry', expiry.toString());
                
                // Clean up URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                document.getElementById('googleSignIn').style.display = 'none';
                document.getElementById('syncStatus').style.display = 'flex';
                document.getElementById('signOutBtn').style.display = 'inline-block';
                
                // Initial sync
                syncWithDrive();
            }
        }

        function signOut() {
            googleAccessToken = null;
            driveFileId = null;
            localStorage.removeItem('google_access_token');
            localStorage.removeItem('google_token_expiry');
            localStorage.removeItem('drive_file_id');
            document.getElementById('googleSignIn').style.display = 'block';
            document.getElementById('syncStatus').style.display = 'none';
            document.getElementById('signOutBtn').style.display = 'none';
        }

        // Check if Claude storage is available, otherwise use localStorage
        async function checkStorage() {
            try {
                if (window.storage && typeof window.storage.get === 'function') {
                    await window.storage.get('test');
                    storageAvailable = true;
                    console.log('Using Claude persistent storage');
                } else {
                    throw new Error('Claude storage not available');
                }
            } catch (e) {
                storageAvailable = false;
                console.log('Using localStorage fallback');
            }
        }

        // Update sync status
        function updateSyncStatus(status, text) {
            const syncStatus = document.getElementById('syncStatus');
            const syncText = document.getElementById('syncText');
            syncStatus.className = 'sync-status ' + status;
            syncText.textContent = text;
        }

        // Sync with Google Drive
        async function syncWithDrive() {
            if (!googleAccessToken) return;
            
            updateSyncStatus('syncing', 'Syncing...');
            
            try {
                // Get all local workout data
                const allData = {};
                for (const muscle of Object.keys(exercises)) {
                    for (const exercise of exercises[muscle]) {
                        const key = `workout:${muscle}:${exercise}`;
                        const data = localStorage.getItem(key);
                        if (data) {
                            allData[key] = data;
                        }
                    }
                }
                
                // Include custom exercises
                const customExercisesData = localStorage.getItem('custom_exercises');
                if (customExercisesData) {
                    allData['custom_exercises'] = customExercisesData;
                }
                
                const dataToSync = JSON.stringify(allData);
                
                // Check if file exists
                if (!driveFileId) {
                    driveFileId = await findOrCreateDriveFile();
                }
                
                // Update file
                await updateDriveFile(driveFileId, dataToSync);
                
                updateSyncStatus('synced', 'Synced');
                setTimeout(() => {
                    document.getElementById('syncStatus').style.display = 'flex';
                }, 2000);
            } catch (error) {
                console.error('Sync error:', error);
                updateSyncStatus('error', 'Sync failed');
            }
        }

        // Find or create workout data file in Drive
        async function findOrCreateDriveFile() {
            // Search for existing file
            const searchResponse = await fetch(
                `https://www.googleapis.com/drive/v3/files?q=name='${DRIVE_FILENAME}'&spaces=appDataFolder`,
                {
                    headers: {
                        'Authorization': `Bearer ${googleAccessToken}`
                    }
                }
            );
            
            const searchData = await searchResponse.json();
            
            if (searchData.files && searchData.files.length > 0) {
                const fileId = searchData.files[0].id;
                localStorage.setItem('drive_file_id', fileId);
                
                // Load data from Drive
                await loadFromDrive(fileId);
                
                return fileId;
            }
            
            // Create new file
            const metadata = {
                name: DRIVE_FILENAME,
                parents: ['appDataFolder']
            };
            
            const createResponse = await fetch(
                'https://www.googleapis.com/drive/v3/files',
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${googleAccessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(metadata)
                }
            );
            
            const createData = await createResponse.json();
            const fileId = createData.id;
            localStorage.setItem('drive_file_id', fileId);
            
            return fileId;
        }

        // Load data from Drive
        async function loadFromDrive(fileId) {
            const response = await fetch(
                `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`,
                {
                    headers: {
                        'Authorization': `Bearer ${googleAccessToken}`
                    }
                }
            );
            
            if (response.ok) {
                const data = await response.json();
                
                // Merge with local data (Drive data takes precedence)
                for (const [key, value] of Object.entries(data)) {
                    localStorage.setItem(key, value);
                }
                
                console.log('Data loaded from Google Drive');
            }
        }

        // Update Drive file
        async function updateDriveFile(fileId, content) {
            const boundary = '-------314159265358979323846';
            const delimiter = "\r\n--" + boundary + "\r\n";
            const close_delim = "\r\n--" + boundary + "--";

            const metadata = {
                mimeType: 'application/json'
            };

            const multipartRequestBody =
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                JSON.stringify(metadata) +
                delimiter +
                'Content-Type: application/json\r\n\r\n' +
                content +
                close_delim;

            const response = await fetch(
                `https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=multipart`,
                {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${googleAccessToken}`,
                        'Content-Type': `multipart/related; boundary="${boundary}"`
                    },
                    body: multipartRequestBody
                }
            );

            if (!response.ok) {
                throw new Error('Failed to update Drive file');
            }
        }

        // Storage wrapper functions
        async function storageGet(key) {
            if (storageAvailable) {
                try {
                    return await window.storage.get(key);
                } catch (e) {
                    console.error('Storage get error:', e);
                    return null;
                }
            } else {
                const value = localStorage.getItem(key);
                return value ? { key, value } : null;
            }
        }

        async function storageSet(key, value) {
            if (storageAvailable) {
                try {
                    return await window.storage.set(key, value);
                } catch (e) {
                    console.error('Storage set error:', e);
                    return null;
                }
            } else {
                localStorage.setItem(key, value);
                return { key, value };
            }
        }

        // Initialize
        async function init() {
            // Handle OAuth redirect first
            handleOAuthRedirect();
            
            // Check Google authentication
            const isAuthenticated = checkGoogleAuth();
            
            await checkStorage();
            
            // Load custom exercises
            await loadCustomExercises();
            
            // If authenticated, sync data from Drive
            if (isAuthenticated && googleAccessToken) {
                await syncWithDrive();
            }
            
            renderTabs();
            renderExercises();
            initProgressScreen();
        }

        // Load custom exercises from storage
        async function loadCustomExercises() {
            try {
                const result = await storageGet('custom_exercises');
                if (result && result.value) {
                    const customExercises = JSON.parse(result.value);
                    // Merge custom exercises with defaults
                    exercises = JSON.parse(JSON.stringify(defaultExercises));
                    for (const [muscle, exerciseList] of Object.entries(customExercises)) {
                        if (exercises[muscle]) {
                            exercises[muscle] = [...exercises[muscle], ...exerciseList];
                        }
                    }
                }
            } catch (e) {
                console.log('No custom exercises found');
            }
        }

        // Save custom exercises
        async function saveCustomExercises() {
            const customExercises = {};
            for (const [muscle, exerciseList] of Object.entries(exercises)) {
                const customOnes = exerciseList.filter(ex => !defaultExercises[muscle].includes(ex));
                if (customOnes.length > 0) {
                    customExercises[muscle] = customOnes;
                }
            }
            await storageSet('custom_exercises', JSON.stringify(customExercises));
            
            // Sync to Drive
            if (googleAccessToken) {
                syncWithDrive();
            }
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('muscleTabs');
            tabsContainer.innerHTML = Object.keys(exercises).map(muscle => 
                `<div class="tab ${muscle === currentMuscle ? 'active' : ''}" onclick="selectMuscle('${muscle}')">${muscle}</div>`
            ).join('');
        }

        async function renderExercises() {
            const container = document.getElementById('exerciseList');
            const exerciseList = exercises[currentMuscle];
            
            const cards = await Promise.all(exerciseList.map(async exercise => {
                const lastWorkout = await getLastWorkout(currentMuscle, exercise);
                return `
                    <div class="exercise-card" onclick="openLogModal('${currentMuscle}', '${exercise}')">
                        <div class="exercise-name">${exercise}</div>
                        <div class="last-workout">
                            ${lastWorkout ? 
                                `<span class="last-workout-value">${lastWorkout.avgWeight.toFixed(1)} lbs √ó ${lastWorkout.avgReps.toFixed(1)} reps</span>
                                <span>‚Ä¢</span>
                                <span>${lastWorkout.date}</span>` :
                                '<span class="no-data">No previous workout</span>'
                            }
                        </div>
                    </div>
                `;
            }));
            
            container.innerHTML = cards.join('');
        }

        function selectMuscle(muscle) {
            currentMuscle = muscle;
            renderTabs();
            renderExercises();
        }

        async function openLogModal(muscle, exercise) {
            currentExercise = { muscle, exercise };
            editingWorkoutIndex = null;
            currentSetCount = 3;
            document.getElementById('modalTitle').textContent = exercise;
            document.getElementById('saveBtn').textContent = 'Save Workout';
            
            const lastWorkout = await getLastWorkout(muscle, exercise);
            const lastRef = document.getElementById('lastReference');
            
            if (lastWorkout) {
                lastRef.innerHTML = `
                    <div class="last-reference-title">Last Workout</div>
                    <div class="last-reference-value">
                        ${lastWorkout.avgWeight.toFixed(1)} lbs √ó ${lastWorkout.avgReps.toFixed(1)} reps (${lastWorkout.sets.length} sets) ‚Ä¢ ${lastWorkout.date}
                    </div>
                `;
            } else {
                lastRef.innerHTML = `
                    <div class="last-reference-title">Last Workout</div>
                    <div class="last-reference-value">No previous data</div>
                `;
            }

            renderSetInputs();

            document.getElementById('workoutHistory').style.display = 'none';
            document.getElementById('logModal').classList.add('show');
        }

        function renderSetInputs() {
            const setsContainer = document.getElementById('setsContainer');
            
            // Save existing values before re-rendering
            const existingValues = [];
            for (let i = 0; i < currentSetCount - 1; i++) {
                const weightInput = document.getElementById(`weight${i}`);
                const repsInput = document.getElementById(`reps${i}`);
                if (weightInput && repsInput) {
                    existingValues[i] = {
                        weight: weightInput.value,
                        reps: repsInput.value
                    };
                }
            }
            
            setsContainer.innerHTML = Array.from({length: currentSetCount}, (_, i) => `
                <div class="set-row" id="setRow${i}">
                    <div class="set-label">Set ${i + 1}</div>
                    <div class="input-group">
                        <div class="input-label">Weight (lbs)</div>
                        <input type="number" id="weight${i}" step="5" min="0" inputmode="decimal" value="${existingValues[i]?.weight || ''}">
                    </div>
                    <div class="input-group">
                        <div class="input-label">Reps</div>
                        <input type="number" id="reps${i}" step="1" min="0" inputmode="numeric" value="${existingValues[i]?.reps || ''}">
                    </div>
                </div>
            `).join('');

            setsContainer.innerHTML += `
                <button class="add-set-btn" onclick="addSet()">+ Add Set</button>
            `;
        }

        function addSet() {
            if (currentSetCount >= 10) {
                alert('Maximum 10 sets allowed');
                return;
            }
            currentSetCount++;
            renderSetInputs();
        }

        async function toggleHistory() {
            const historyDiv = document.getElementById('workoutHistory');
            const isVisible = historyDiv.style.display !== 'none';
            
            if (isVisible) {
                historyDiv.style.display = 'none';
            } else {
                await renderWorkoutHistory();
                historyDiv.style.display = 'block';
            }
        }

        async function renderWorkoutHistory() {
            const workouts = await getAllWorkouts(currentExercise.muscle, currentExercise.exercise);
            const historyDiv = document.getElementById('workoutHistory');
            
            if (workouts.length === 0) {
                historyDiv.innerHTML = '<div class="history-empty">No workout history yet</div>';
                return;
            }
            
            // Show most recent first
            const reversedWorkouts = [...workouts].reverse();
            
            historyDiv.innerHTML = reversedWorkouts.map((workout, index) => {
                const actualIndex = workouts.length - 1 - index;
                const setsDisplay = workout.sets.map((set, i) => 
                    `Set ${i + 1}: ${set.weight} lbs √ó ${set.reps} reps`
                ).join(', ');
                
                return `
                    <div class="history-item">
                        <div class="history-header">
                            <div class="history-date">${workout.date}</div>
                            <div class="history-actions">
                                <button class="history-btn edit" onclick="editWorkout(${actualIndex})">Edit</button>
                                <button class="history-btn delete" onclick="deleteWorkout(${actualIndex})">Delete</button>
                            </div>
                        </div>
                        <div class="history-stats">
                            <div class="history-stat">Avg Weight: <span>${workout.avgWeight.toFixed(1)} lbs</span></div>
                            <div class="history-stat">Avg Reps: <span>${workout.avgReps.toFixed(1)}</span></div>
                            <div class="history-stat">Volume: <span>${workout.volume.toFixed(0)}</span></div>
                            <div class="history-stat">Sets: <span>${workout.sets.length}</span></div>
                        </div>
                        <div class="history-sets">${setsDisplay}</div>
                    </div>
                `;
            }).join('');
        }

        async function editWorkout(index) {
            editingWorkoutIndex = index;
            const workouts = await getAllWorkouts(currentExercise.muscle, currentExercise.exercise);
            const workout = workouts[index];
            
            // Set the number of sets to match the workout being edited
            currentSetCount = workout.sets.length;
            renderSetInputs();
            
            // Fill in the form with existing data
            workout.sets.forEach((set, i) => {
                document.getElementById(`weight${i}`).value = set.weight;
                document.getElementById(`reps${i}`).value = set.reps;
            });
            
            // Change button text
            document.getElementById('saveBtn').textContent = 'Update Workout';
            
            // Hide history
            document.getElementById('workoutHistory').style.display = 'none';
            
            // Scroll to top of modal
            document.querySelector('.modal-content').scrollTop = 0;
        }

        async function deleteWorkout(index) {
            if (!confirm('Are you sure you want to delete this workout?')) {
                return;
            }
            
            const workouts = await getAllWorkouts(currentExercise.muscle, currentExercise.exercise);
            workouts.splice(index, 1);
            
            const key = `workout:${currentExercise.muscle}:${currentExercise.exercise}`;
            await storageSet(key, JSON.stringify(workouts));
            
            // Sync to Drive
            if (googleAccessToken) {
                syncWithDrive();
            }
            
            // Refresh history and exercise list
            await renderWorkoutHistory();
            renderExercises();
        }

        function closeModal() {
            document.getElementById('logModal').classList.remove('show');
            editingWorkoutIndex = null;
            currentSetCount = 3;
            document.getElementById('saveBtn').textContent = 'Save Workout';
            document.getElementById('workoutHistory').style.display = 'none';
        }

        async function saveWorkout() {
            try {
                const sets = [];
                for (let i = 0; i < currentSetCount; i++) {
                    const weightInput = document.getElementById(`weight${i}`);
                    const repsInput = document.getElementById(`reps${i}`);
                    if (weightInput && repsInput) {
                        const weight = parseFloat(weightInput.value);
                        const reps = parseFloat(repsInput.value);
                        if (weight && reps) {
                            sets.push({ weight, reps });
                        }
                    }
                }

                if (sets.length === 0) {
                    alert('Please enter at least one set');
                    return;
                }

                const avgWeight = sets.reduce((sum, s) => sum + s.weight, 0) / sets.length;
                const avgReps = sets.reduce((sum, s) => sum + s.reps, 0) / sets.length;
                const volume = avgWeight * avgReps;

                const workout = {
                    date: new Date().toISOString().split('T')[0],
                    muscle: currentExercise.muscle,
                    exercise: currentExercise.exercise,
                    sets: sets,
                    avgWeight: avgWeight,
                    avgReps: avgReps,
                    volume: volume
                };

                if (editingWorkoutIndex !== null) {
                    // Update existing workout
                    const workouts = await getAllWorkouts(currentExercise.muscle, currentExercise.exercise);
                    
                    // Keep the original date when editing
                    workout.date = workouts[editingWorkoutIndex].date;
                    workouts[editingWorkoutIndex] = workout;
                    
                    const key = `workout:${currentExercise.muscle}:${currentExercise.exercise}`;
                    await storageSet(key, JSON.stringify(workouts));
                    
                    editingWorkoutIndex = null;
                } else {
                    // Save new workout
                    const lastWorkout = await getLastWorkout(currentExercise.muscle, currentExercise.exercise);
                    
                    await saveWorkoutData(workout);

                    if (lastWorkout && volume > lastWorkout.volume) {
                        showPRCelebration();
                    }
                }

                // Sync to Drive
                if (googleAccessToken) {
                    syncWithDrive();
                }

                closeModal();
                renderExercises();
            } catch (error) {
                console.error('Error saving workout:', error);
                alert('Error saving workout. Check console for details.');
            }
        }

        function showPRCelebration() {
            const celebration = document.createElement('div');
            celebration.className = 'pr-celebration';
            celebration.textContent = 'üéâ NEW PR! üéâ';
            document.body.appendChild(celebration);
            setTimeout(() => celebration.remove(), 2000);
        }

        async function getLastWorkout(muscle, exercise) {
            try {
                const key = `workout:${muscle}:${exercise}`;
                const result = await storageGet(key);
                if (result && result.value) {
                    const data = JSON.parse(result.value);
                    return data[data.length - 1];
                }
            } catch (e) {
                console.log('No previous workout found:', e);
            }
            return null;
        }

        async function saveWorkoutData(workout) {
            const key = `workout:${workout.muscle}:${workout.exercise}`;
            try {
                const result = await storageGet(key);
                let data = [];
                if (result && result.value) {
                    data = JSON.parse(result.value);
                }
                data.push(workout);
                await storageSet(key, JSON.stringify(data));
                console.log('Workout saved successfully');
                
                // Sync to Google Drive if signed in
                if (googleAccessToken) {
                    syncWithDrive();
                }
            } catch (e) {
                console.error('Error saving workout:', e);
                await storageSet(key, JSON.stringify([workout]));
                
                // Sync to Google Drive if signed in
                if (googleAccessToken) {
                    syncWithDrive();
                }
            }
        }

        async function getAllWorkouts(muscle, exercise) {
            const key = `workout:${muscle}:${exercise}`;
            try {
                const result = await storageGet(key);
                if (result && result.value) {
                    return JSON.parse(result.value);
                }
            } catch (e) {
                console.log('No workout history:', e);
            }
            return [];
        }

        function switchScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            if (screen === 'log') {
                document.getElementById('logScreen').classList.add('active');
                document.querySelectorAll('.nav-btn')[0].classList.add('active');
            } else if (screen === 'progress') {
                document.getElementById('progressScreen').classList.add('active');
                document.querySelectorAll('.nav-btn')[1].classList.add('active');
                updateRadarChart();
                updateProgressChart();
            } else if (screen === 'manage') {
                document.getElementById('manageScreen').classList.add('active');
                renderManageExercises();
            }
        }

        function renderManageExercises() {
            const container = document.getElementById('manageExercisesList');
            let html = '';
            
            for (const [muscle, exerciseList] of Object.entries(exercises)) {
                html += `
                    <div class="muscle-group-section">
                        <div class="muscle-group-header">${muscle}</div>
                        <div class="add-exercise-section">
                            <div class="add-exercise-title">Add New Exercise</div>
                            <input type="text" class="add-exercise-input" id="newExercise_${muscle}" placeholder="Enter exercise name...">
                            <button class="add-exercise-btn" onclick="addExercise('${muscle}')">+ Add Exercise</button>
                        </div>
                `;
                
                // Show custom exercises only (ones not in default list)
                const customExercises = exerciseList.filter(ex => !defaultExercises[muscle].includes(ex));
                if (customExercises.length > 0) {
                    html += '<div style="margin-top: 12px;">';
                    customExercises.forEach(exercise => {
                        html += `
                            <div class="custom-exercise-item">
                                <div class="custom-exercise-name">${exercise}</div>
                                <button class="delete-exercise-btn" onclick="deleteExercise('${muscle}', '${exercise}')">Delete</button>
                            </div>
                        `;
                    });
                    html += '</div>';
                }
                
                html += '</div>';
            }
            
            container.innerHTML = html;
        }

        async function addExercise(muscle) {
            const input = document.getElementById(`newExercise_${muscle}`);
            const exerciseName = input.value.trim();
            
            if (!exerciseName) {
                alert('Please enter an exercise name');
                return;
            }
            
            if (exercises[muscle].includes(exerciseName)) {
                alert('This exercise already exists');
                return;
            }
            
            exercises[muscle].push(exerciseName);
            await saveCustomExercises();
            
            input.value = '';
            renderManageExercises();
            renderTabs();
            renderExercises();
            
            // Update progress screen dropdowns
            updateExerciseSelect();
        }

        async function deleteExercise(muscle, exercise) {
            if (!confirm(`Delete "${exercise}"? This will also delete all workout history for this exercise.`)) {
                return;
            }
            
            // Remove from exercises list
            exercises[muscle] = exercises[muscle].filter(ex => ex !== exercise);
            await saveCustomExercises();
            
            // Delete workout data
            const key = `workout:${muscle}:${exercise}`;
            try {
                if (storageAvailable) {
                    await window.storage.delete(key);
                } else {
                    localStorage.removeItem(key);
                }
            } catch (e) {
                console.log('No data to delete');
            }
            
            // Sync to Drive
            if (googleAccessToken) {
                syncWithDrive();
            }
            
            renderManageExercises();
            renderExercises();
            updateExerciseSelect();
        }

        function initProgressScreen() {
            const muscleSelect = document.getElementById('progressMuscleSelect');
            muscleSelect.innerHTML = Object.keys(exercises).map(muscle => 
                `<option value="${muscle}">${muscle}</option>`
            ).join('');
            muscleSelect.addEventListener('change', updateExerciseSelect);

            updateExerciseSelect();
        }

        function updateExerciseSelect() {
            const muscle = document.getElementById('progressMuscleSelect').value;
            const exerciseSelect = document.getElementById('progressExerciseSelect');
            exerciseSelect.innerHTML = exercises[muscle].map(exercise => 
                `<option value="${exercise}">${exercise}</option>`
            ).join('');
            updateProgressChart();
        }

        async function updateProgressChart() {
            const muscle = document.getElementById('progressMuscleSelect').value;
            const exercise = document.getElementById('progressExerciseSelect').value;
            
            const workouts = await getAllWorkouts(muscle, exercise);
            
            if (workouts.length === 0) {
                const container = document.querySelector('.chart-container');
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <div class="empty-state-text">No workout data yet.<br>Log your first workout to see progress!</div>
                    </div>
                `;
                document.getElementById('statsGrid').innerHTML = '';
                return;
            }

            if (!document.getElementById('progressChart')) {
                document.querySelector('.chart-container').innerHTML = '<canvas id="progressChart"></canvas>';
            }

            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: workouts.map(w => w.date),
                    datasets: [{
                        label: 'Volume (Avg Weight √ó Avg Reps)',
                        data: workouts.map(w => w.volume),
                        borderColor: '#7DF9FF',
                        backgroundColor: 'rgba(125, 249, 255, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#333'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        },
                        x: {
                            grid: {
                                color: '#333'
                            },
                            ticks: {
                                color: '#a0a0a0'
                            }
                        }
                    }
                }
            });

            // Update stats
            const bestVolume = Math.max(...workouts.map(w => w.volume));
            const avgVolume = workouts.reduce((sum, w) => sum + w.volume, 0) / workouts.length;
            const totalWorkouts = workouts.length;

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Best</div>
                    <div class="stat-value">${bestVolume.toFixed(0)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average</div>
                    <div class="stat-value">${avgVolume.toFixed(0)}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Workouts</div>
                    <div class="stat-value">${totalWorkouts}</div>
                </div>
            `;
        }

        async function updateRadarChart() {
            // Count workouts per muscle group
            const muscleCounts = {};
            for (const muscle of Object.keys(exercises)) {
                muscleCounts[muscle] = 0;
                for (const exercise of exercises[muscle]) {
                    const workouts = await getAllWorkouts(muscle, exercise);
                    muscleCounts[muscle] += workouts.length;
                }
            }

            const ctx = document.getElementById('radarChart').getContext('2d');
            
            if (radarChart) {
                radarChart.destroy();
            }

            const muscleGroups = Object.keys(exercises);
            const counts = muscleGroups.map(m => muscleCounts[m]);

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: muscleGroups,
                    datasets: [{
                        label: 'Workouts',
                        data: counts,
                        borderColor: '#7DF9FF',
                        backgroundColor: 'rgba(125, 249, 255, 0.2)',
                        pointBackgroundColor: '#7DF9FF',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#7DF9FF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            grid: {
                                color: '#333'
                            },
                            angleLines: {
                                color: '#333'
                            },
                            pointLabels: {
                                color: '#a0a0a0',
                                font: {
                                    size: 12,
                                    weight: '600'
                                }
                            },
                            ticks: {
                                color: '#a0a0a0',
                                backdropColor: 'transparent'
                            }
                        }
                    }
                }
            });
        }

        document.getElementById('progressExerciseSelect').addEventListener('change', updateProgressChart);

        init();
    </script>
</body>
</html>
